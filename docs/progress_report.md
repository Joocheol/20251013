# 20251013 프로젝트 진행 보고서

## 1. 프로젝트 개요

본 문서는 2025년 10월 13일까지 진행된 `20251013` 리포지토리의 주요 작업을 3쪽 분량으로 정리한 종합 보고서이다. 보고서는 CSV 기반 주식 데이터셋을 다루는 분석 도구 개발을 중심으로 한 활동을 다루며, 핵심 산출물은 다음 두 가지 파이썬 스크립트이다.

1. `analyze_temp_csv.py`: 다중 종목 OHLCV 데이터를 파싱하고 요약 통계를 생성하는 의존성 없는 분석 스크립트.
2. `efficient_frontier.py`: 동일한 데이터 파싱 로직을 재활용하여 효율적 투자선(efficient frontier)을 계산하고 시각화용 산출물을 제공하는 스크립트.

두 스크립트는 공통적으로 표준 라이브러리만 활용하도록 설계되어, 별도의 패키지 설치가 어려운 환경에서도 재사용 가능한 것이 특징이다. 또한 모든 기능이 `temp.csv`뿐 아니라 사용자 지정 CSV 파일로 확장될 수 있도록 범용적으로 구현되어 있다.

## 2. 데이터셋과 분석 범위

### 2.1 데이터셋 개요

- 파일 구조: `temp.csv`는 두 줄 헤더(지표 행과 종목 행)를 가진 멀티 인덱스 형태로 구성되어 있으며, 각 열은 특정 종목의 특정 지표(시가·고가·저가·종가·거래량)를 의미한다.
- 포함 종목: 삼성전자(005930.KS), 애플(AAPL), 엔비디아(NVDA).
- 기간: 2023-10-16부터 2025-10-10까지 총 516거래일의 데이터.
- 지표 범위: Close, High, Low, Open, Volume 등 5개 핵심 지표.

### 2.2 주요 통계 요약

`analyze_temp_csv.py`를 실행하여 도출한 통계치는 다음과 같은 특징을 보여준다.

- **삼성전자(005930.KS)**: 종가 기준 평균 66,472원 수준이며, 2024-11-15에 +7.21%의 최고 수익률, 2024-08-05에 -10.30%의 최저 수익률을 기록하였다. 거래량 평균은 약 1,948만 주로 상대적으로 안정적인 수준이다.
- **애플(AAPL)**: 평균 종가는 약 209.52달러이며 2025-04-09에 +15.33%, 2025-04-03에 -9.25%의 변동성을 나타냈다. 거래량은 평균 5,655만 주로, 삼성전자 대비 글로벌 테크기업의 유동성을 반영한다.
- **엔비디아(NVDA)**: 평균 종가는 115.60달러, 최고 일간 수익률은 2025-04-09의 +18.72%, 최저는 2025-01-27의 -16.97%로 세 종목 중 가장 높은 변동성을 보인다. 거래량 평균은 3.25억 주로, AI 반도체 수요 급증이 수치에 반영된 것으로 해석된다.
- **수익률 상관관계**: 세 종목 간 일별 종가 수익률 상관계수는 삼성전자-애플 0.1124, 애플-엔비디아 0.3741로 글로벌 IT 섹터 내 동조화를 확인할 수 있다. 반면 삼성전자-엔비디아의 상관계수는 0.0855로 낮아 지역 및 사업 구조 차이가 반영된다.

## 3. `analyze_temp_csv.py` 개발 경과

### 3.1 설계 목표

- **의존성 최소화**: 외부 라이브러리 없이 표준 라이브러리만으로 CSV 파싱과 통계 계산을 수행하도록 설계하여 재현성을 높였다.
- **데이터 품질 방어**: 공백 셀이나 헤더 불일치 등 예외 상황을 대비한 방어적 프로그래밍을 적용하였다.
- **재사용성 강화**: 주요 기능을 함수 형태(`load_ohlcv`, `describe_dataset`, `compute_daily_returns`)로 분리하여 다른 스크립트에서도 동일한 파싱 로직을 사용할 수 있도록 했다.

### 3.2 핵심 구현 요소

1. **두 줄 헤더 정규화**: `load_ohlcv` 함수에서 첫 두 줄의 헤더를 `zip`으로 묶어 `(종목, 지표)` 쌍을 구성하고, 이후 각 데이터 행을 순회하며 `defaultdict` 기반 중첩 딕셔너리에 저장한다.
2. **결측치 처리**: 값이 비어 있을 경우 해당 셀을 건너뛰어 통계 계산 시 오류를 방지한다. 숫자 파싱 단계에서 공백을 발견하면 명확한 예외를 발생시켜 데이터 정합성을 점검할 수 있도록 했다.
3. **요약 통계 산출**: `MetricSummary` 데이터 클래스를 활용해 지표별 개수, 최소값, 최대값, 평균을 계산하고 가독성 있는 문자열 형태로 포맷한다.
4. **일별 수익률 계산**: `compute_daily_returns` 함수가 이전 거래일 대비 변화를 계산하며, 종가가 0인 경우 0 수익률 처리로 분모 0 문제를 예방한다.
5. **상관관계 행렬**: `_aligned_correlation`과 `_correlation`을 통해 종목 간 일별 수익률 상관관계를 계산하고, 포맷팅된 표로 결과를 출력한다.

### 3.3 실행 결과와 활용성

스크립트 실행 시 `Dataset overview`, `Ticker`별 요약, `Close-to-close return correlations` 등 세 부분으로 구성된 보고서를 터미널에 출력한다. 이를 통해 데이터 이상 여부를 빠르게 확인하고, 이후 분석(예: 포트폴리오 최적화)에 필요한 기본 통계 정보를 확보할 수 있다. 또한 `describe_dataset` 함수는 문자열이 아닌 파이썬 객체 반환 버전으로 확장하기 쉬운 구조를 제공하여, 향후 API화나 웹 서비스 통합 시에도 유용하다.

## 4. `efficient_frontier.py` 개발 경과

### 4.1 목적과 접근 방식

효율적 투자선은 위험 대비 수익이 가장 우수한 포트폴리오 조합을 찾는 개념이다. 본 스크립트는 `analyze_temp_csv.py`에서 구현한 데이터 파싱 및 수익률 계산 함수들을 가져와 다음 절차를 따른다.

1. CSV에서 각 종목의 종가 시계열을 로딩하고 일별 수익률을 계산한다.
2. 모든 종목의 수익률을 동일한 거래일 기준으로 정렬·정렬(`_align_returns`).
3. 수익률 평균과 공분산 행렬을 계산하여 포트폴리오 위험(표준편차)과 기대수익을 산출한다.
4. 지정된 격자 해상도(`--step`)에 따라 모든 가능한 장기(롱) 비중 조합을 생성한다.
5. 포트폴리오 집합에서 비지배 솔루션만을 추출하여 효율적 투자선을 형성한다.
6. 결과를 텍스트 표로 출력하고, 옵션에 따라 `matplotlib`를 활용한 산점도를 저장한다.

### 4.2 기술적 특징

- **가중치 격자 생성**: `_generate_weight_grid` 함수는 재귀적 탐색을 통해 각 종목 비중이 합계 1이 되도록 하는 모든 조합을 생성한다. `step` 파라미터는 해상도를 조절하여 계산량과 정확성을 균형 있게 관리한다.
- **공분산 계산**: `_covariance` 함수가 표본 공분산을 계산하며, 수익률 길이 불일치나 관측치 부족 시 명확한 예외를 발생시킨다.
- **효율적 투자선 추출**: 위험(표준편차) 기준으로 정렬한 뒤, 기대수익이 증가하는 지점만 선별하는 단순하면서도 직관적인 알고리즘을 사용한다.
- **시각화 옵션**: 기본적으로 `efficient_frontier.png`에 그래프를 저장하지만 `--no-plot` 플래그로 그래프 생성을 생략할 수 있어, 서버 환경 등 그래픽 라이브러리가 제한된 상황에서도 실행 가능하다.

### 4.3 실행 결과 예시

`python efficient_frontier.py --no-plot` 실행 시 다음과 같은 포트폴리오 조합이 효율선에 포함된다.

| 기대수익 | 위험(표준편차) | 포트폴리오 가중치 |
|---------:|---------------:|---------------------|
| 0.00103 | 0.01376 | 005930.KS 44%, AAPL 51%, NVDA 5% |
| 0.00111 | 0.01377 | 005930.KS 44%, AAPL 48%, NVDA 8% |
| 0.00121 | 0.01405 | 005930.KS 41%, AAPL 46%, NVDA 13% |
| … | … | … |

같은 위험 수준에서 기대수익이 조금이라도 높은 조합만 남기므로, 실제 투자 포트폴리오 설계 시 초기 참고 자료로 활용할 수 있다. 또한 `--step`을 0.02와 같이 크게 설정하면 빠른 탐색이 가능하고, 0.005로 낮추면 더 촘촘한 효율선 추정이 가능하다.

## 5. 실행 환경 및 유지보수 고려사항

- **의존성 관리**: 두 스크립트 모두 표준 라이브러리만 사용하므로, Python 3.11 이상이 설치된 환경이면 추가 설치 없이 실행된다. 다만 효율적 투자선 그래프 저장을 위해서는 선택적으로 `matplotlib` 설치가 필요하다.
- **예외 처리**: CSV 포맷 오류, 데이터 부족, 격자 해상도 입력 오류 등의 상황을 명확한 예외 메시지로 안내한다. 사용자 경험을 높이기 위해 향후 사용자 친화적 CLI 인터페이스(예: progress bar, 로그 레벨)를 도입할 수 있다.
- **성능**: 현재 3개 종목 기준으로는 문제 없으나, 종목 수가 증가하면 격자 탐색이 급격히 늘어난다. 향후에는 무작위 탐색(Monte Carlo)이나 최적화 알고리즘(예: Quadratic Programming)으로 확장할 수 있다.

## 6. 향후 개선 방향

1. **데이터 소스 확장**: API 연동을 통해 최신 데이터를 자동으로 갱신하거나, 여러 CSV 파일을 병합하는 기능을 추가하면 리포트 자동화에 도움이 된다.
2. **보고서 자동화**: 현재는 텍스트 기반 보고서이므로, Jupyter Notebook 또는 PDF 생성 워크플로우를 구축하여 정기 리포트를 자동 생성하는 방안을 검토할 수 있다.
3. **리스크 지표 다양화**: 효율적 투자선 외에도 맥스 드로다운, 샤프 지수 등 다양한 리스크/성과 지표를 계산하여 투자 의사결정에 필요한 정보를 확대할 수 있다.
4. **테스트 커버리지 강화**: 핵심 함수에 대한 단위 테스트를 추가하면 데이터 포맷 변경이나 코드 리팩토링 시 안정성을 확보할 수 있다.

## 7. 결론

2025년 10월 13일 현재, `20251013` 프로젝트는 CSV 데이터 정규화와 요약 분석, 효율적 투자선 계산이라는 두 축에서 의미 있는 진전을 이뤘다. `analyze_temp_csv.py`와 `efficient_frontier.py`는 서로의 기능을 보완하며, 데이터 탐색부터 기본적인 포트폴리오 최적화까지 일관된 워크플로우를 제공한다. 향후에는 데이터 소스 확장, 시각화 고도화, 자동화 보고서 체계 구축 등을 통해 프로젝트의 활용 가치를 더욱 높일 수 있을 것이다.
